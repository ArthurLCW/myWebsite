# Network

## 1. OSI & TCP/IP 模型

#### 1.1. __7个层必背__！！！

会话层：同步服务、管理连接状态（用户名密码）；表示层：解码编码；传输层（socket，TCP/UDP)

![1690730424264](network1.png)



1.2. 各层数据、地址

![1690733485816](network2.png)



## 2. IP 协议

#### 2.1. IPv4 子网掩码

IP地址=网络号+主机号

子网掩码：用以区分网络号和主机号的边界。

例子：

![1690873100419](network5.png)

子网掩码：255.255.255.252.       

上图的30是CIDR写法，表示前30位是网络号，后两位是主机号。

（CIDR（Classless Inter-Domain Routing，无类域间路由选择）它消除了传统的A类、B类和C类地址以及划分子网的概念，因而可以更加有效地分配IPv4的地址空间）。

#### 2.2. IPv6

128位。（IPv4：32位）。



## 3. TCP协议

#### 3.1. 三次握手

![1690820262110](network3.png)

为什么要三次握手？

__一次不行__：不能确定对方是否可以收到信息。

__两次不行__：不能避免历史连接。倘若有失效的链接，未经过客户端确认（第三次握手）就发送相关信息可能导致发的信息是错误的。

#### 3.2. 四次挥手

![1690822640981](network4.png)

**第一次挥手**：客户端想关闭通信，告诉服务端，我不想和你通信了。 

**第二次挥手**：但服务端可能还有数据 发给客户端的没有传完。因此先给一个确认。在这之后客户端不需要再发送一次挥手了，可以节省资源。

**第三次挥手**：等服务器端传输完毕，再告诉客户端我们结束吧。

**第四次挥手**：客户端收到 服务器的结束通信的信息，给服务器一个确认。



## 4. HTTP协议

#### 4.1. HTTPS

##### 4.1.1. HTTPS = HTTP + SSL/TLS

##### 4.1.2. TLS握手

![1691982179841](network6.png)



1. 注意server hello done
2. **预主密钥**通过**非对称加密**（如RSA）生成。用户端生成预主密钥后用服务器公钥加密后发送给服务器，服务器用自己的私钥解密得到预主密钥。
3. 用户端和客户端各自通过第一随机数、第二随机数、预主密钥生成**会话密钥**。会话密钥**不需要传输**。
4. **非对称加密（如RSA）生成预主密钥，确保安全性；对称加密（如AES）用于会话加密，确保高效率**。



## 5. Cookie, Token, Session, LocalStorage

#### 5.1. Intuition

HTTP无状态，如何保持用户登陆状态？答：每次发送请求都带上身份验证信息。于是有了cookie

#### 5.2. Cookie

数据的载体（相当于车），cookie加请求一起发送给服务器。

早期的rest请求直接把账密放到cookie里。

Cookie在客户端发送相关请求之后在服务端中生成，然后发给客户端。

#### 5.3. Session ID和Token

##### 5.3.1. Session

SessionID产生于服务器，发送给浏览器，由服务器存储。Session由**服务器主导**。

优点：相比于直接发送账密提供了一定的安全性，sessionID泄露影响不大。

缺点：增加服务器负载。服务器需要自行存储、删除、维护sessionID，且在分布式系统中还需要多服务器同步sessionID。

##### 5.3.2. Token

Token产生于服务器，发送给浏览器。Token由**浏览器主导**。浏览器存储Token，但无法解密token。

优点：服务器不必储存Token。解决了分布式系统的同步问题。

#### 5.4. Storage

##### 5.4.1. Storage VS Cookie

Storage大，不参与通信（不被发送到服务器），有效期无限或到窗口关闭。

Cookie小，参与通信（会被发送到服务器），有效期自行设置。

##### 5.4.2. Local Storage VS Session Storage

1. 有效期不同。local storage永久有效，session storage关闭窗口后失效。

2. 访问不同窗口的权限不同。 `sessionStorage` 在不同的窗口或标签页之间是独立的； `localStorage` 在同一个浏览器的所有窗口和标签页之间是共享的（只要它们**同源**） 。

   "同源" 指的是相同的协议、域名和端口。 













